// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  userID     Int     @id @default(autoincrement())
  userFname  String
  userLname  String
  userGender String
  userEmail  String  @unique
  userPhone  String
  userPass   String
  userPic    String?

  sessions Session[]
}

model Shop {
  shopID        Int     @id @default(autoincrement())
  shopFname     String
  shopLname     String
  shopGender    String
  shopEmail     String  @unique
  shopPhone     String
  shopPass      String
  shopName      String
  shopLocation  String
  shopPic       String?
  shopQR        String?
  shopOpenTime  String  @default("09:00")
  shopCloseTime String  @default("18:00")
  shopOpen      Boolean @default(false)

  history  ShopHistory[]
  sessions Session[]
  foods    Food[]
  foodgenre FoodGenre[]
  optiongroup OptionGroup[]
}

model Admin {
  adminID    Int     @id @default(autoincrement())
  adminFname String
  adminLname String
  adminEmail String  @unique
  adminPhone String
  adminPass  String
  adminPic   String?

  sessions Session[]
}

model Customer {
  customerID    Int     @id @default(autoincrement())
  customerFname String
  customerLname String
  customerEmail String  @unique
  customerPhone String
  customerPass  String
  customerPic   String?

  sessions Session[]
}

model Session {
  id        String   @id @default(cuid())
  token     String   @unique
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  userId    Int?
  user      User?    @relation(fields: [userId], references: [userID], onDelete: Cascade)
  
  shopId    Int?
  shop      Shop?    @relation(fields: [shopId], references: [shopID], onDelete: Cascade)
  
  adminId   Int?
  admin     Admin?   @relation(fields: [adminId], references: [adminID], onDelete: Cascade)

  customerId   Int?
  customer     Customer?   @relation(fields: [customerId], references: [customerID], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@index([shopId])
  @@index([adminId])
  @@index([customerId])
}

model ShopHistory {
  shopHistoryID Int @id @default(autoincrement())
  shopID    Int
  shopLogin     DateTime
  shopLogout    DateTime?

  shop      Shop     @relation(fields: [shopID], references: [shopID])
}

model Food {
  foodID  Int @id @default(autoincrement())
  shopID  Int
  foodName  String
  foodDetails String
  foodPrice Float
  foodPic String
  foodGenreID Int
  foodOptions Int[]
  foodStatus Boolean @default(true)

  shop  Shop  @relation(fields: [shopID], references: [shopID])
}

model FoodGenre {
  fGenreID Int @id @default(autoincrement())
  fGenreName String
  shopID  Int

  shop  Shop  @relation(fields: [shopID], references: [shopID])
}

model OptionGroup {
  ogID  Int @id @default(autoincrement())
  ogName  String
  ogMultiple  Boolean
  ogForce Boolean
  shopID Int

  option Option[]

  shop  Shop  @relation(fields: [shopID], references: [shopID])
}

model Option {
  opID  Int @id @default(autoincrement())
  ogID  Int
  opName  String
  opPrice Float

  optionGroup OptionGroup @relation(fields: [ogID], references: [ogID])
}
